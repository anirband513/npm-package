{{#hasAntd}}
import { Card, Form, Input, Button, Typography, Steps, Row, Col, Space, Divider, Radio } from 'antd'
import { CreditCardOutlined, ShoppingOutlined, CheckCircleOutlined } from '@ant-design/icons'
{{/hasAntd}}
import { useState } from 'react'
{{#hasRedux}}
import { useSelector, useDispatch } from 'react-redux'
import { clearCart } from '../store/cartSlice'
{{/hasRedux}}
{{#hasRouter}}
import { useNavigate } from 'react-router-dom'
{{/hasRouter}}

{{#hasAntd}}
const { Title, Text } = Typography
{{/hasAntd}}

{{#isTypeScript}}
function Checkout(): JSX.Element {
{{/isTypeScript}}
{{^isTypeScript}}
function Checkout() {
{{/isTypeScript}}
  const [currentStep, setCurrentStep] = useState(0)
  {{#hasRedux}}
  const cartItems = useSelector((state{{#isTypeScript}}: any{{/isTypeScript}}) => state.cart?.items || [])
  const dispatch = useDispatch()
  
  const subtotal = cartItems.reduce(
    (total{{#isTypeScript}}: number{{/isTypeScript}}, item{{#isTypeScript}}: any{{/isTypeScript}}) => total + item.price * item.quantity,
    0
  )
  const tax = subtotal * 0.1
  const shipping = 10
  const total = subtotal + tax + shipping
  {{/hasRedux}}
  {{#hasRouter}}
  const navigate = useNavigate()
  {{/hasRouter}}

  const onFinishShipping = (values{{#isTypeScript}}: any{{/isTypeScript}}) => {
    console.log('Shipping info:', values)
    setCurrentStep(1)
  }

  const onFinishPayment = (values{{#isTypeScript}}: any{{/isTypeScript}}) => {
    console.log('Payment info:', values)
    setCurrentStep(2)
    {{#hasRedux}}
    // Clear cart after successful checkout
    setTimeout(() => {
      dispatch(clearCart())
      {{#hasRouter}}
      navigate('/')
      {{/hasRouter}}
    }, 3000)
    {{/hasRedux}}
  }

  const steps = [
    {
      title: 'Shipping',
      icon: <ShoppingOutlined />,
    },
    {
      title: 'Payment',
      icon: <CreditCardOutlined />,
    },
    {
      title: 'Complete',
      icon: <CheckCircleOutlined />,
    },
  ]

  return (
    {{#hasAntd}}
    <div>
      <Title level={2}>Checkout</Title>
      
      <Card style={{ marginBottom: 24 }}>
        <Steps current={currentStep} items={steps} />
      </Card>

      <Row gutter={24}>
        <Col xs={24} lg={16}>
          {currentStep === 0 && (
            <Card title="Shipping Information">
              <Form layout="vertical" onFinish={onFinishShipping}>
                <Row gutter={16}>
                  <Col span={12}>
                    <Form.Item label="First Name" name="firstName" rules={[{ required: true }]}>
                      <Input placeholder="John" />
                    </Form.Item>
                  </Col>
                  <Col span={12}>
                    <Form.Item label="Last Name" name="lastName" rules={[{ required: true }]}>
                      <Input placeholder="Doe" />
                    </Form.Item>
                  </Col>
                </Row>
                <Form.Item label="Email" name="email" rules={[{ required: true, type: 'email' }]}>
                  <Input placeholder="john@example.com" />
                </Form.Item>
                <Form.Item label="Phone" name="phone" rules={[{ required: true }]}>
                  <Input placeholder="+1 234 567 8900" />
                </Form.Item>
                <Form.Item label="Address" name="address" rules={[{ required: true }]}>
                  <Input placeholder="123 Main St" />
                </Form.Item>
                <Row gutter={16}>
                  <Col span={12}>
                    <Form.Item label="City" name="city" rules={[{ required: true }]}>
                      <Input placeholder="New York" />
                    </Form.Item>
                  </Col>
                  <Col span={12}>
                    <Form.Item label="Zip Code" name="zip" rules={[{ required: true }]}>
                      <Input placeholder="10001" />
                    </Form.Item>
                  </Col>
                </Row>
                <Form.Item>
                  <Button type="primary" htmlType="submit" size="large">
                    Continue to Payment
                  </Button>
                </Form.Item>
              </Form>
            </Card>
          )}

          {currentStep === 1 && (
            <Card title="Payment Information">
              <Form layout="vertical" onFinish={onFinishPayment}>
                <Form.Item label="Payment Method" name="paymentMethod" initialValue="card">
                  <Radio.Group>
                    <Space direction="vertical">
                      <Radio value="card">Credit/Debit Card</Radio>
                      <Radio value="paypal">PayPal</Radio>
                      <Radio value="cod">Cash on Delivery</Radio>
                    </Space>
                  </Radio.Group>
                </Form.Item>
                <Form.Item label="Card Number" name="cardNumber" rules={[{ required: true }]}>
                  <Input placeholder="1234 5678 9012 3456" maxLength={19} />
                </Form.Item>
                <Row gutter={16}>
                  <Col span={12}>
                    <Form.Item label="Expiry Date" name="expiry" rules={[{ required: true }]}>
                      <Input placeholder="MM/YY" maxLength={5} />
                    </Form.Item>
                  </Col>
                  <Col span={12}>
                    <Form.Item label="CVV" name="cvv" rules={[{ required: true }]}>
                      <Input placeholder="123" maxLength={3} />
                    </Form.Item>
                  </Col>
                </Row>
                <Form.Item label="Cardholder Name" name="cardName" rules={[{ required: true }]}>
                  <Input placeholder="John Doe" />
                </Form.Item>
                <Space>
                  <Button onClick={() => setCurrentStep(0)}>
                    Back
                  </Button>
                  <Button type="primary" htmlType="submit" size="large">
                    Place Order
                  </Button>
                </Space>
              </Form>
            </Card>
          )}

          {currentStep === 2 && (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <CheckCircleOutlined style={{ fontSize: 64, color: '#52c41a', marginBottom: 16 }} />
                <Title level={2}>Order Placed Successfully!</Title>
                <Text type="secondary">
                  Thank you for your purchase. You will receive a confirmation email shortly.
                </Text>
              </div>
            </Card>
          )}
        </Col>

        <Col xs={24} lg={8}>
          <Card title="Order Summary">
            {{#hasRedux}}
            <Space direction="vertical" style={{ width: '100%' }} size="middle">
              {cartItems.map((item{{#isTypeScript}}: any{{/isTypeScript}}) => (
                <div key={item.id} style={{ display: 'flex', gap: 12 }}>
                  <img
                    src={item.image}
                    alt={item.title}
                    style={{ width: 60, height: 60, objectFit: 'contain' }}
                  />
                  <div style={{ flex: 1 }}>
                    <Text ellipsis>{item.title.substring(0, 40)}</Text>
                    <br />
                    <Text type="secondary">
                      {item.quantity} Ã— ${item.price.toFixed(2)}
                    </Text>
                  </div>
                </div>
              ))}
              <Divider />
              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                <Text>Subtotal:</Text>
                <Text strong>${subtotal.toFixed(2)}</Text>
              </div>
              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                <Text>Tax (10%):</Text>
                <Text strong>${tax.toFixed(2)}</Text>
              </div>
              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                <Text>Shipping:</Text>
                <Text strong>${shipping.toFixed(2)}</Text>
              </div>
              <Divider />
              <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                <Title level={4} style={{ margin: 0 }}>Total:</Title>
                <Title level={4} style={{ margin: 0, color: '#1890ff' }}>
                  ${total.toFixed(2)}
                </Title>
              </div>
            </Space>
            {{/hasRedux}}
            {{^hasRedux}}
            <Text>Enable Redux to view order summary</Text>
            {{/hasRedux}}
          </Card>
        </Col>
      </Row>
    </div>
    {{/hasAntd}}
    {{^hasAntd}}
    <div className="checkout-page">
      <h2>Checkout</h2>
      <div className="checkout-form">
        <form onSubmit={(e) => { e.preventDefault(); onFinishPayment({}); }}>
          <h3>Shipping Information</h3>
          <input type="text" placeholder="Full Name" required />
          <input type="email" placeholder="Email" required />
          <input type="text" placeholder="Address" required />
          
          <h3>Payment Information</h3>
          <input type="text" placeholder="Card Number" required />
          <input type="text" placeholder="MM/YY" required />
          <input type="text" placeholder="CVV" required />
          
          <button type="submit">Place Order</button>
        </form>
      </div>
    </div>
    {{/hasAntd}}
  )
}

export default Checkout
